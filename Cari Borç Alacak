-----HAREKETLERDEKİ PLASİYER KODUNA GÖRE
select case when B.CARI_TIP='A' THEN 'MUSTERI' WHEN  B.CARI_TIP='S' THEN 'TEDARIKCI' WHEN  B.CARI_TIP='M' THEN 'MUSTAHSIL' WHEN  B.CARI_TIP='T' THEN 'TOPTANCI' 
WHEN  B.CARI_TIP='K' THEN 'KEFIL' WHEN  B.CARI_TIP='D' THEN 'DIGER' WHEN  B.CARI_TIP='V' THEN 'AVUKAT' END AS TIP,          
B.CARI_KOD,DBO.TRK(B.CARI_ISIM) AS CARI_ISIM,C.PLASIYER_KODU, C.PLASIYER_ACIKLAMA,
SUM(BORC) -SUM(ALACAK) As BAKIYE,CASE WHEN SUM(BORC) -SUM(ALACAK) >0 THEN 'Borçlu' Else 'Alacakli' End AS BA from tblcahar a 
INNER JOIN TBLCASABIT B ON B.CARI_KOD=A.CARI_KOD
INNER JOIN TBLCARIPLASIYER C ON C.PLASIYER_KODU=A.PLASIYER_KODU
GROUP BY B.CARI_TIP,B.CARI_KOD,DBO.TRK(B.CARI_ISIM) ,C.PLASIYER_KODU,C.PLASIYER_ACIKLAMA

CREATE PROCEDURE dbo.Aris_Borc_Alacak_plasiyer_hareket
AS
BEGIN
    SET NOCOUNT ON;
	---exec dbo.Aris_Borc_Alacak_plasiyer_hareket
    SELECT 
        CASE 
            WHEN B.CARI_TIP = 'A' THEN 'MUSTERI'
            WHEN B.CARI_TIP = 'S' THEN 'TEDARIKCI'
            WHEN B.CARI_TIP = 'M' THEN 'MUSTAHSIL'
            WHEN B.CARI_TIP = 'T' THEN 'TOPTANCI'
            WHEN B.CARI_TIP = 'K' THEN 'KEFIL'
            WHEN B.CARI_TIP = 'D' THEN 'DIGER'
            WHEN B.CARI_TIP = 'V' THEN 'AVUKAT'
        END AS TIP,          
        B.CARI_KOD,
        DBO.TRK(B.CARI_ISIM) AS CARI_ISIM,
        C.PLASIYER_KODU, 
        C.PLASIYER_ACIKLAMA,
        SUM(BORC) - SUM(ALACAK) AS BAKIYE,
        CASE 
            WHEN SUM(BORC) - SUM(ALACAK) > 0 THEN 'Borçlu' 
            ELSE 'Alacakli' 
        END AS BA
    FROM TBLCaHar A
    INNER JOIN TBLCASABIT B ON B.CARI_KOD = A.CARI_KOD
    INNER JOIN TBLCARIPLASIYER C ON C.PLASIYER_KODU = A.PLASIYER_KODU
    GROUP BY 
        B.CARI_TIP,
        B.CARI_KOD,
        DBO.TRK(B.CARI_ISIM),
        C.PLASIYER_KODU,
        C.PLASIYER_ACIKLAMA;
END;


-----CARİ KARTLARDAKİ PLASİYER KODUNA GÖRE
select case when B.CARI_TIP='A' THEN 'MUSTERI' WHEN  B.CARI_TIP='S' THEN 'TEDARIKCI' WHEN  B.CARI_TIP='M' THEN 'MUSTAHSIL' WHEN  B.CARI_TIP='T' THEN 'TOPTANCI' 
WHEN  B.CARI_TIP='K' THEN 'KEFIL' WHEN  B.CARI_TIP='D' THEN 'DIGER' WHEN  B.CARI_TIP='V' THEN 'AVUKAT' END AS TIP,          
B.CARI_KOD,DBO.TRK(B.CARI_ISIM) AS CARI_ISIM,C.PLASIYER_KODU, C.PLASIYER_ACIKLAMA,
SUM(BORC) -SUM(ALACAK) As BAKIYE,CASE WHEN SUM(BORC) -SUM(ALACAK) >0 THEN 'Borçlu' Else 'Alacakli' End AS BA from tblcahar a 
INNER JOIN TBLCASABIT B ON B.CARI_KOD=A.CARI_KOD
INNER JOIN TBLCARIPLASIYER C ON C.PLASIYER_KODU=B.PLASIYER_KODU
GROUP BY B.CARI_TIP,B.CARI_KOD,DBO.TRK(B.CARI_ISIM) ,C.PLASIYER_KODU,C.PLASIYER_ACIKLAMA

CREATE PROCEDURE dbo.Aris_Borc_Alacak_Plasiyer_Carikart
AS
BEGIN
    SET NOCOUNT ON;
	---exec dbo.Aris_Borc_Alacak_Plasiyer_Carikart
    SELECT 
        CASE 
            WHEN B.CARI_TIP = 'A' THEN 'MUSTERI'
            WHEN B.CARI_TIP = 'S' THEN 'TEDARIKCI'
            WHEN B.CARI_TIP = 'M' THEN 'MUSTAHSIL'
            WHEN B.CARI_TIP = 'T' THEN 'TOPTANCI'
            WHEN B.CARI_TIP = 'K' THEN 'KEFIL'
            WHEN B.CARI_TIP = 'D' THEN 'DIGER'
            WHEN B.CARI_TIP = 'V' THEN 'AVUKAT'
        END AS TIP,          
        B.CARI_KOD,
        DBO.TRK(B.CARI_ISIM) AS CARI_ISIM,
        C.PLASIYER_KODU, 
        C.PLASIYER_ACIKLAMA,
        SUM(BORC) - SUM(ALACAK) AS BAKIYE,
        CASE 
            WHEN SUM(BORC) - SUM(ALACAK) > 0 THEN 'Borçlu' 
            ELSE 'Alacakli' 
        END AS BA
    FROM TBLCaHar A
    INNER JOIN TBLCASABIT B ON B.CARI_KOD = A.CARI_KOD
    INNER JOIN TBLCARIPLASIYER C ON C.PLASIYER_KODU = B.PLASIYER_KODU
    GROUP BY 
        B.CARI_TIP,
        B.CARI_KOD,
        DBO.TRK(B.CARI_ISIM),
        C.PLASIYER_KODU,
        C.PLASIYER_ACIKLAMA;
END;

-----cari borc alacak
select case when B.CARI_TIP='A' THEN 'MUSTERI' WHEN  B.CARI_TIP='S' THEN 'TEDARIKCI' WHEN  B.CARI_TIP='M' THEN 'MUSTAHSIL' WHEN  B.CARI_TIP='T' THEN 'TOPTANCI' 
WHEN  B.CARI_TIP='K' THEN 'KEFIL' WHEN  B.CARI_TIP='D' THEN 'DIGER' WHEN  B.CARI_TIP='V' THEN 'AVUKAT' END AS TIP, B.CARI_KOD,DBO.TRK(B.CARI_ISIM) AS CARI_ISIM,SUM(BORC) -SUM(ALACAK) As BAKIYE,
CASE WHEN SUM(BORC) -SUM(ALACAK) >0 THEN 'Borçlu' Else 'Alacakli' End AS BA from tblcahar a 
INNER JOIN TBLCASABIT B ON B.CARI_KOD=A.CARI_KOD
GROUP BY B.CARI_TIP,B.CARI_KOD,DBO.TRK(B.CARI_ISIM) 

CREATE PROCEDURE dbo.Aris_Borc_Alacak
AS
BEGIN
    SET NOCOUNT ON;
	--exec dbo.Aris_Borc_Alacak
    SELECT 
        CASE 
            WHEN B.CARI_TIP = 'A' THEN 'MUSTERI'
            WHEN B.CARI_TIP = 'S' THEN 'TEDARIKCI'
            WHEN B.CARI_TIP = 'M' THEN 'MUSTAHSIL'
            WHEN B.CARI_TIP = 'T' THEN 'TOPTANCI'
            WHEN B.CARI_TIP = 'K' THEN 'KEFIL'
            WHEN B.CARI_TIP = 'D' THEN 'DIGER'
            WHEN B.CARI_TIP = 'V' THEN 'AVUKAT'
        END AS TIP, 
        B.CARI_KOD,
        DBO.TRK(B.CARI_ISIM) AS CARI_ISIM,
        SUM(BORC) - SUM(ALACAK) AS BAKIYE,
        CASE 
            WHEN SUM(BORC) - SUM(ALACAK) > 0 THEN 'Borçlu' 
            ELSE 'Alacakli' 
        END AS BA
    FROM TBLCaHar A
    INNER JOIN TBLCASABIT B ON B.CARI_KOD = A.CARI_KOD
    GROUP BY 
        B.CARI_TIP,
        B.CARI_KOD,
        DBO.TRK(B.CARI_ISIM);
END;


